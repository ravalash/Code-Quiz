<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="Assets/reset.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Hello, world!</title>
</head>

<body>
    <main class="container">
        <div class="row">
            <div class="col-6" style="margin: auto;">
                <div class="card bg-light" id="question-section" style="min-height: 30vh;text-align: center;">
                    <h2 class="card-title">Categories</h2>
                </div>
                <div id="instructions-section" style="text-align: center;">
                    <h2>Please select a category</h2>
                </div>
            </div>
            <div class="col-3">
                <div class="card text-center bg-light d-none" id="quiz-clock">
                    <div class="card-body">
                        <h5 class="card-title">Time Left</h5>
                        <p class="card-text" id="timer-section"></p>
                        <h5 class="card-text" id="answer-feedback"></h5>
                    </div>

                </div>
            </div>
        </div>





    </main>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script>
        var questionSet = "qSet1";
        var selectionCategory = "";
        var selectionNumber = "";
        var selectionName = "";
        var x = 1;
        var quizQuestion = "";
        var quizAnswers = [null, null, null, null];
        var quizRightAnswer = "";
        var quizRandom = 0;
        var quizRandomNumbers = new Array;
        var reroll = true;
        var quizCorrect = 0;
        var quizTotal = 0;
        var quizNumberRight = 0;
        var quizNumberWrong = 0;
        var quizSeconds = 0;
        var quizTimer = 0;
        var clearTimer = false;
        var finalScore = 0;

        categories = {
            javaQuestions: {
                category: "Java",
                qSet1: {
                    question: "Is this a question?",
                    wrongAnswers: ["carrot", "potato", "donkey"],
                    rightAnswer: "yes"
                },
                qSet2: {
                    question: "Is this a cat?",
                    wrongAnswers: ["sticks", "stones", "rocks"],
                    rightAnswer: "no"
                },
                qSet3: {
                    question: "Is this a dog?",
                    wrongAnswers: ["poop", "face", "nose"],
                    rightAnswer: "no"
                }
            },
            disneyQuestions: {
                category: "Disney Characters",
                qSet1: {
                    question: "Is this a mouse?",
                    wrongAnswers: ["puppy", "kitten", "bat"],
                    rightAnswer: "yes"
                },
                qSet2: {
                    question: "Is this a bird?",
                    wrongAnswers: ["heart", "sour", "baby"],
                    rightAnswer: "no"
                }
            },
            musicQuestions: {
                category: "Pop Music",
                qSet1: {
                    question: "Is this a question?",
                    wrongAnswers: ["carrot", "potato", "donkey"],
                    rightAnswer: "yes"
                },
                qSet2: {
                    question: "Is this a cat?",
                    wrongAnswers: ["sticks", "stones", "rocks"],
                    rightAnswer: "no"
                }
            },
            travelQuestions: {
                category: "Travel Destinations",
                qSet1: {
                    question: "Is this a question?",
                    wrongAnswers: ["carrot", "potato", "donkey"],
                    rightAnswer: "yes"
                },
                qSet2: {
                    question: "Is this a cat?",
                    wrongAnswers: ["sticks", "stones", "rocks"],
                    rightAnswer: "no"
                }
            }
        }
        Object.freeze(categories.javaQuestions);

        // Runs through database and loads all question categories on screen
        function loadCategories() {
            var categoryArray = Object.keys(categories);
            for (i = 0; i < Object.keys(categories).length; i++) {
                var categoryName = Object.values(categories)[i].category;
                var categoryObject = Object.keys(categories)[i];
                console.log(categoryName);
                var categoryButton = document.createElement("button");
                categoryButton.setAttribute("data-category", categoryName);
                categoryButton.setAttribute("data-object", categoryObject);
                categoryButton.setAttribute("class", "btn btn-primary m-1 category-btn");
                categoryButton.setAttribute("data-number", i);
                categoryButton.setAttribute("style", "width: 100%");
                categoryButton.textContent = categoryName;
                document.getElementById("question-section").appendChild(categoryButton);
            }
        }

        // Loads first set of quiz questions into memory from chosen category, clears category buttons, displays instructions
        function chooseCategory() {
            event.preventDefault();
            selectionCategory = event.target.getAttribute("data-object");
            selectionNumber = event.target.getAttribute("data-number");
            selectionName = event.target.textContent;
            console.log(selectionCategory + " " + selectionNumber);
            clearQuestionDiv("question-section");
            loadQuizQuestions();
            loadInstructions();
            // buildQuestionButtons();

        }

        // Loads number of questions in set and readies question from question set
        function loadQuizQuestions() {
            // quizAnswers = clearArray(quizAnswers);
            quizAnswers = [];
            console.log(quizAnswers);
            quizQuestionNumber = Object.entries(categories[selectionCategory]).length;
            console.log(quizQuestionNumber);
            quizQuestion = categories[selectionCategory][questionSet].question;
            console.log(quizQuestion);
            console.log(categories[selectionCategory][questionSet].wrongAnswers);
            for (i = 0; i < (categories[selectionCategory][questionSet].wrongAnswers).length; i++) {
                quizAnswers[i] = (categories[selectionCategory][questionSet].wrongAnswers)[i]
            }
            console.log(quizAnswers);
            quizRightAnswer = categories[selectionCategory][questionSet].rightAnswer;
            console.log(quizRightAnswer);
            quizAnswers[quizAnswers.length] = quizRightAnswer
            console.log(quizAnswers);
        }

        // Randomizes array answers to build answer buttons for display
        function buildQuestionButtons() {
            quizSeconds = (quizQuestionNumber - 1) * 6
            console.log("build questions");
            for (i = 0; i < quizAnswers.length; i++) {
                console.log(quizAnswers.length);
                while (reroll === true) {
                    quizRandom = Math.floor(Math.random() * quizAnswers.length);
                    console.log(quizRandom);
                    reroll = false;
                    for (x = -1; x < quizRandomNumbers.length; x++) {
                        if (quizRandomNumbers[x] == quizRandom) {
                            reroll = true;
                        }
                    }
                }
                var questionButton = document.createElement("button");
                questionButton.setAttribute("class", "btn btn-primary m-1 question-btn");
                questionButton.setAttribute("style", "width: 100%");
                questionButton.textContent = quizAnswers[quizRandom];
                quizRandomNumbers.push(quizRandom);
                reroll = true;
                document.getElementById("answer-section").appendChild(questionButton);
            }
            quizRandomNumbers = [];

        }

        // Displays instructions on screen and presents start and back buttons. Sets ID for clickable sections, clears previous event handler
        function loadInstructions() {
            document.getElementById("question-section").firstElementChild.textContent = "Instructions";
            var instructions = document.createElement("p");
            instructions.textContent = "You will be presented with a series of questions on " + selectionName + ". Each incorrect answer will reduce the alloted time to complete the quiz. Questions are presented until they have all been answered or the clock has expired. Your final score is based on the time remaining on the clock at the end."
            instructions.setAttribute("class", "card mt-5");
            document.getElementById("question-section").appendChild(instructions);
            document.getElementById("question-section").removeEventListener("click", chooseCategory);
            document.getElementById("question-section").setAttribute("id", "start-section");
            document.getElementById("instructions-section").firstElementChild.textContent = "Please select an option";
            var instructionsButton = document.createElement("button");
            instructionsButton.setAttribute("class", "btn btn-success m-1 instructions-btn");
            instructionsButton.setAttribute("style", "width: 50%");
            instructionsButton.textContent = "Start";
            document.getElementById("instructions-section").appendChild(instructionsButton);
            var instructionsButton = document.createElement("button");
            instructionsButton.setAttribute("class", "btn btn-danger m-1 instructions-btn");
            instructionsButton.setAttribute("style", "width: 50%");
            instructionsButton.textContent = "Back";
            document.getElementById("instructions-section").appendChild(instructionsButton);
            document.getElementById("instructions-section").addEventListener("click", chooseInstruction);

        }



        // Clears out question div for category buttons
        function clearQuestionDiv(divName) {
            while (x) {
                if (document.getElementById(divName).lastElementChild.nodeName == "BUTTON") {

                    document.getElementById(divName).removeChild(document.getElementById(divName).lastElementChild);
                }
                else {
                    return;
                }

            }

        }

        function toggleClock(clockSwitch) {
            if (clockSwitch === "off") {
                document.getElementById("quiz-clock").setAttribute("class", "card text-center bg-light d-none");
            }
            else if (clockSwitch === "on") {
                document.getElementById("quiz-clock").setAttribute("class", "card text-center bg-light")
            }
        }

        // Clears buttons from instructions screen - Condensed into previous function
        // function clearInstructionsDiv() {
        //     while (x) {
        //         if (document.getElementById("instructions-section").lastElementChild.nodeName == "BUTTON") {

        //             document.getElementById("instructions-section").removeChild(document.getElementById("instructions-section").lastElementChild);
        //         }
        //         else {
        //             return;
        //         }

        //     }

        // }

        // Clears instruction paragraph on instructions screen
        function clearStartSection() {
            while (x) {
                if (document.getElementById("start-section").lastElementChild.nodeName == "P") {

                    document.getElementById("start-section").removeChild(document.getElementById("start-section").lastElementChild);
                }
                else {
                    return;
                }

            }

        }

        // Handles clicking of start and back on instructions screen
        function chooseInstruction() {
            console.log(event);
            console.log(event.target);
            console.log(event.target.textContent);
            if (event.target.textContent == "Back") {
                clearQuestionDiv("instructions-section");
                clearStartSection();
                document.getElementById("start-section").firstElementChild.textContent = "Categories";
                document.getElementById("instructions-section").firstElementChild.textContent = "Please select a category";
                document.getElementById("start-section").setAttribute("id", "question-section");
                document.getElementById("question-section").addEventListener("click", chooseCategory);
                document.getElementById("instructions-section").removeEventListener("click", chooseInstruction)
                loadCategories();
            }
            if (event.target.textContent == "Start") {
                clearQuestionDiv("instructions-section");
                clearStartSection();
                document.getElementById("start-section").firstElementChild.textContent = quizQuestion;
                document.getElementById("instructions-section").firstElementChild.textContent = "Choose an Answer";
                document.getElementById("start-section").setAttribute("id", "answer-section");
                document.getElementById("answer-section").addEventListener("click", chooseAnswer);
                document.getElementById("instructions-section").removeEventListener("click", chooseInstruction);
                buildQuestionButtons();
                quizTimer = quizSeconds;
                toggleClock("on");
                updateTimer();
            }

        }

        function clearArray(myArray) {
            console.log(myArray);
            for (i = 0; i < myArray.length; i++) {
                myArray.pop();
                console.log(myArray);
            }
            return myArray;
        }

        function loadResults() {
            var results = document.createElement("p");
            results.textContent = "Right Answers: " + quizNumberRight + " Wrong Answers: " + quizNumberWrong + " Final Score: " + finalScore;
            results.setAttribute("class", "card-body mt-3");
            results.setAttribute("style", "text-align: center");
            document.getElementById("answer-section").appendChild(results);

        }

        // Handles clicking of answers and logging right or wrong answers
        function chooseAnswer() {
            quizTotal = quizTotal + 1
            console.log(event);
            console.log(event.target);
            console.log(event.target.textContent);
            if (event.target.textContent == quizRightAnswer) {
                quizNumberRight = quizNumberRight + 1;
                quizCorrect = 1;
                document.getElementById("answer-feedback").textContent = "Correct!";
                document.getElementById("answer-feedback").setAttribute("class", "card-text text-success");
            }
            else {
                quizNumberWrong = quizNumberWrong + 1;
                quizCorrect = 0;
                quizTimer = quizTimer - 3;
                document.getElementById("answer-feedback").textContent = "Wrong!";
                document.getElementById("answer-feedback").setAttribute("class", "card-text text-danger");
            }
            console.log(quizCorrect);
            clearQuestionDiv("answer-section");
            if (quizTotal < quizQuestionNumber - 1) {
                questionSet = "qSet" + (quizTotal + 1);
                loadQuizQuestions();
                buildQuestionButtons();
            }
            else {
                clearTimer = true;
                finalScore = quizTimer;
                updateTimer;
                loadResults();
            }

        }

        function updateTimer() {


            var myTimer = setInterval(function () {
                if (clearTimer === true) {
                    clearInterval(myTimer);
                    return;
                }

                quizTimer--;
                document.getElementById("timer-section").textContent = quizTimer;
                if (quizTimer === 0) {
                    finalScore = quizTimer;
                    clearQuestionDiv("answer-section");
                    clearInterval(myTimer);
                    loadResults();
                }






            }, 1000);

        }

        loadCategories();
        document.getElementById("question-section").addEventListener("click", chooseCategory);



    </script>
</body>

</html>